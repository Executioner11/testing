--!strict
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local TEXT_COLOR = Color3.fromRGB(255,255,255)
local BLUEWARE_BLUE = Color3.fromRGB(0,140,255)
local SLIDER_COLOR = BLUEWARE_BLUE
local SLIDER_BG_COLOR = Color3.fromRGB(60,60,60)
local TOGGLE_BG_COLOR = Color3.fromRGB(50,50,50)
local WINDOW_BG_COLOR = Color3.fromRGB(0,0,0)

local UI = Instance.new("ScreenGui")
UI.Name = "BlueWare"
UI.ResetOnSpawn = false
UI.Parent = PlayerGui

local Notifications = {}

-- UTILITY FUNCTIONS
local function tween(obj, props, time, style, dir)
	return TweenService:Create(obj, TweenInfo.new(time, style, dir), props)
end

local function createRoundedFrame(parent, size, pos, bgColor, bgTransparency, cornerRadius)
	local frame = Instance.new("Frame")
	frame.Size = size
	frame.Position = pos
	frame.BackgroundColor3 = bgColor
	frame.BackgroundTransparency = bgTransparency or 0
	frame.BorderSizePixel = 0
	frame.Parent = parent

	local corner = Instance.new("UICorner")
	corner.CornerRadius = cornerRadius or UDim.new(0,10)
	corner.Parent = frame

	return frame
end

local function makeDraggable(window, dragArea)
	local dragging, dragStart, startPos
	dragArea.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = window.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	UIS.InputChanged:Connect(function(input)
		if dragging then
			local delta = input.Position - dragStart
			window.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

-- SLIDE ANIMATION
local function slideInWindow(window)
	window.Position = UDim2.new(0.5,-225,1,0)
	window.Visible = true
	tween(window,{Position=UDim2.new(0.5,-225,0.5,-150)},0.45,Enum.EasingStyle.Quad,Enum.EasingDirection.Out):Play()
end

local function slideOutWindow(window)
	local t = tween(window,{Position=UDim2.new(0.5,-225,1,0)},0.45,Enum.EasingStyle.Quad,Enum.EasingDirection.In)
	t:Play()
	t.Completed:Once(function() window.Visible=false end)
end

-- WINDOW CREATION
local function createWindow(title)
	local Window = createRoundedFrame(UI,UDim2.new(0,450,0,300),UDim2.new(0.5,-225,1,0),WINDOW_BG_COLOR,0.15)
	Window.Visible=false

	-- Title Bar
	local TitleBar = createRoundedFrame(Window,UDim2.new(1,0,0,30),UDim2.new(0,0,0,0),Color3.fromRGB(20,20,20),0.15,UDim.new(0,0))
	local Title = Instance.new("TextLabel",TitleBar)
	Title.Size=UDim2.new(1,-40,1,0)
	Title.Position=UDim2.new(0,10,0,0)
	Title.BackgroundTransparency=1
	Title.Text=title
	Title.Font=Enum.Font.SourceSansBold
	Title.TextSize=18
	Title.TextColor3=TEXT_COLOR
	Title.TextXAlignment=Enum.TextXAlignment.Left

	local Close = Instance.new("TextButton",TitleBar)
	Close.Size=UDim2.new(0,30,0,30)
	Close.Position=UDim2.new(1,-30,0,0)
	Close.BackgroundTransparency=1
	Close.Text="X"
	Close.Font=Enum.Font.SourceSansBold
	Close.TextSize=18
	Close.TextColor3=TEXT_COLOR
	Close.MouseButton1Click:Connect(function()
		slideOutWindow(Window)
	end)

	makeDraggable(Window,TitleBar)

	-- Tabs
	local TabsFrame = createRoundedFrame(Window,UDim2.new(1,0,0,30),UDim2.new(0,0,0,30),Color3.fromRGB(0,0,0),1)
	local TabsScrolling = Instance.new("ScrollingFrame")
	TabsScrolling.Size = UDim2.new(1,0,1,0)
	TabsScrolling.BackgroundTransparency = 1
	TabsScrolling.ScrollBarThickness = 6
	TabsScrolling.Parent = TabsFrame
	TabsScrolling.CanvasSize = UDim2.new(0,0,0,0)
	local tabsLayout = Instance.new("UIListLayout",TabsScrolling)
	tabsLayout.FillDirection = Enum.FillDirection.Horizontal
	tabsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	tabsLayout.Padding = UDim.new(0,10)

	-- WHITE UNDERLINE BAR
	local Underline = createRoundedFrame(TabsFrame,UDim2.new(0,0,0,2),UDim2.new(0,0,1,-2),Color3.fromRGB(255,255,255),0,UDim.new(0,0))

	local CurrentTabContent
	local Tabs = {}

	local function addTab(name)
		local tabButton = Instance.new("TextButton")
		tabButton.Size = UDim2.new(0,100,1,0)
		tabButton.BackgroundTransparency = 1
		tabButton.Text = name
		tabButton.Font = Enum.Font.SourceSans
		tabButton.TextSize = 16
		tabButton.TextColor3 = TEXT_COLOR
		tabButton.Parent = TabsScrolling

		local tabContent = Instance.new("ScrollingFrame")
		tabContent.Size = UDim2.new(1,0,1,-60)
		tabContent.Position = UDim2.new(0,0,0,60)
		tabContent.BackgroundTransparency = 1
		tabContent.Visible = false
		tabContent.CanvasSize = UDim2.new(0,0,0,0)
		tabContent.ScrollBarThickness = 6
		tabContent.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar
		tabContent.Parent = Window

		local layout = Instance.new("UIListLayout", tabContent)
		layout.SortOrder = Enum.SortOrder.LayoutOrder
		layout.Padding = UDim.new(0,10)
		layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			tabContent.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 10)
		end)

		local function activateTab()
			if CurrentTabContent then CurrentTabContent.Visible = false end
			tabContent.Visible = true
			CurrentTabContent = tabContent

			-- Move underline
			task.defer(function()
				local textWidth = tabButton.TextBounds.X
				local relativeX = tabButton.Position.X.Offset + (tabButton.Size.X.Offset - textWidth)/2
				tween(Underline,{
					Position = UDim2.new(0, relativeX, 1, -2),
					Size = UDim2.new(0, textWidth, 0, 2)
				},0.25,Enum.EasingStyle.Quad,Enum.EasingDirection.Out):Play()
			end)
		end

		tabButton.MouseButton1Click:Connect(activateTab)
		table.insert(Tabs, tabButton)

		if #Tabs == 1 then
			task.wait()
			activateTab()
		end

		TabsScrolling.CanvasSize = UDim2.new(0, (#Tabs)*(tabButton.Size.X.Offset + 10),0,0)
		return tabContent
	end

	return Window, addTab, Underline
end

-- NOTIFICATIONS
local NotificationFolder = Instance.new("Folder")
NotificationFolder.Name = "Notifications"
NotificationFolder.Parent = UI

local function showNotification(text,duration)
	local notif = createRoundedFrame(NotificationFolder, UDim2.new(0,300,0,60), UDim2.new(1,-10,1,-10), Color3.fromRGB(0,0,0), 0.25, UDim.new(0,10))
	notif.AnchorPoint = Vector2.new(1,1)
	notif.ClipsDescendants = true

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1,-20,1,-15)
	label.Position = UDim2.new(0,10,0,5)
	label.BackgroundTransparency = 1
	label.Text = text
	label.TextColor3 = TEXT_COLOR
	label.TextWrapped = true
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Font = Enum.Font.SourceSans
	label.TextSize = 16
	label.Parent = notif

	local timerBar = createRoundedFrame(notif, UDim2.new(1,0,0,5), UDim2.new(0,0,1,-5), Color3.fromRGB(0,255,0), 0, UDim.new(0,2))

	table.insert(Notifications,notif)
	local index = #Notifications
	tween(notif, {Position=UDim2.new(1,-10,1,-10-(index-1)*70)}, 0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out):Play()

	local startTime = tick()
	local conn
	conn = RunService.RenderStepped:Connect(function()
		local elapsed = tick()-startTime
		local percent = math.clamp(1-elapsed/duration,0,1)
		timerBar.Size = UDim2.new(percent,0,0,5)
		if percent<=0 then
			tween(notif,{Position=UDim2.new(1,310,notif.Position.Y.Scale,notif.Position.Y.Offset)},0.3,Enum.EasingStyle.Quad,Enum.EasingDirection.In):Play()
			task.delay(0.3,function()
				notif:Destroy()
				table.remove(Notifications,1)
				for i,n in ipairs(NotificationFolder:GetChildren()) do
					tween(n,{Position=UDim2.new(1,-10,1,-10-(i-1)*70)},0.2,Enum.EasingStyle.Quad,Enum.EasingDirection.Out):Play()
				end
			end)
			conn:Disconnect()
		end
	end)
end

-- TOGGLE
local function createToggle(parent,labelText,defaultState,callback)
	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(1,-20,0,40)
	frame.BackgroundTransparency = 1
	frame.Parent = parent

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(0,100,1,0)
	label.Position = UDim2.new(0,10,0,0)
	label.BackgroundTransparency = 1
	label.Text = labelText
	label.TextColor3 = TEXT_COLOR
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Font = Enum.Font.SourceSans
	label.TextSize = 16
	label.Parent = frame

	local toggleFrame = createRoundedFrame(frame, UDim2.new(0,50,0,25), UDim2.new(0,115,0.5,-12), TOGGLE_BG_COLOR, 0, UDim.new(0,12))
	local toggleCircle = createRoundedFrame(toggleFrame, UDim2.new(0,21,0,21), UDim2.new(defaultState and 1 or 0,0,0.5,0), SLIDER_COLOR,0, UDim.new(1,0))
	toggleCircle.AnchorPoint = Vector2.new(defaultState and 1 or 0,0.5)

	local toggled = defaultState
	local function updateToggle(state)
		toggled = state
		TweenService:Create(toggleCircle,TweenInfo.new(0.2,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{
			Position = UDim2.new(state and 1 or 0,0,0.5,0),
			AnchorPoint = Vector2.new(state and 1 or 0,0.5)
		}):Play()
		if callback then callback(toggled) end
	end

	toggleFrame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			updateToggle(not toggled)
		end
	end)
	toggleFrame.TouchTap:Connect(function()
		updateToggle(not toggled)
	end)

	return frame
end

-- SLIDER
local function createSlider(parent,labelText,min,max,default)
	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(1,-20,0,40)
	frame.BackgroundTransparency = 1
	frame.Parent = parent

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(0,100,1,0)
	label.Position = UDim2.new(0,10,0,0)
	label.BackgroundTransparency = 1
	label.Text = labelText
	label.TextColor3 = TEXT_COLOR
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Font = Enum.Font.SourceSans
	label.TextSize = 16
	label.Parent = frame

	local valueLabel = Instance.new("TextLabel")
	valueLabel.Size = UDim2.new(0,50,1,0)
	valueLabel.Position = UDim2.new(1,-60,0,0)
	valueLabel.BackgroundTransparency = 1
	valueLabel.TextColor3 = TEXT_COLOR
	valueLabel.Font = Enum.Font.SourceSans
	valueLabel.TextSize = 16
	valueLabel.Text = tostring(default)
	valueLabel.TextXAlignment = Enum.TextXAlignment.Right
	valueLabel.Parent = frame

	local sliderBar = createRoundedFrame(frame,UDim2.new(0.5,0,0.3,0),UDim2.new(0,115,0.35,0),SLIDER_BG_COLOR,0,UDim.new(0,4))
	local knobSize = 12
	local sliderKnob = createRoundedFrame(sliderBar,UDim2.new(0,knobSize,0,knobSize),UDim2.new((default-min)/(max-min),0,0.5,0),SLIDER_COLOR,0,UDim.new(1,0))
	sliderKnob.AnchorPoint = Vector2.new(0.5,0.5)

	local dragging=false
	local function updateSlider(inputPosX)
		local relative = math.clamp((inputPosX-sliderBar.AbsolutePosition.X)/sliderBar.AbsoluteSize.X,0,1)
		TweenService:Create(sliderKnob,TweenInfo.new(0.1,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{Position=UDim2.new(relative,0,0.5,0)}):Play()
		valueLabel.Text = tostring(math.floor(min + relative*(max-min)))
	end

	sliderKnob.InputBegan:Connect(function(input)
		if input.UserInputType==Enum.UserInputType.MouseButton1 then dragging=true end
	end)
	sliderKnob.InputEnded:Connect(function(input)
		if input.UserInputType==Enum.UserInputType.MouseButton1 then dragging=false end
	end)
	UIS.InputChanged:Connect(function(input)
		if dragging and input.UserInputType==Enum.UserInputType.MouseMovement then
			updateSlider(input.Position.X)
		end
	end)
	local function mobileDrag(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			updateSlider(input.Position.X)
		end
	end
	sliderBar.InputBegan:Connect(mobileDrag)
	sliderBar.InputChanged:Connect(mobileDrag)
end

-- BIG BLUE "B" BUTTON
local OpenButton = Instance.new("TextLabel")
OpenButton.Size = UDim2.new(0,60,0,60)
OpenButton.Position = UDim2.new(0,10,0.5,0)
OpenButton.BackgroundTransparency = 1
OpenButton.Text = "B"
OpenButton.TextColor3 = BLUEWARE_BLUE
OpenButton.Font = Enum.Font.SourceSansBold
OpenButton.TextSize = 50
OpenButton.Parent = UI
OpenButton.AnchorPoint = Vector2.new(0,0.5)
makeDraggable(OpenButton,OpenButton)

local opened=false

-- CREATE WINDOW AND DEMO TABS
local win, addTab, underline = createWindow("BlueWare")

OpenButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		opened = not opened
		if opened then slideInWindow(win) else slideOutWindow(win) end
	end
end)

-- DEMO TABS
local tab1 = addTab("Main")
local tab2 = addTab("Misc")
local tab3 = addTab("Settings")

-- 10 Test Toggles on Main
for i=1,10 do
	createToggle(tab1,"Toggle "..i,false,function(state) showNotification("Toggle "..i.." "..(state and "ON" or "OFF"),2) end)
end

-- Sliders and Toggles on other tabs
createSlider(tab2,"Brightness",0,100,75)
createToggle(tab2,"Misc Toggle",true,function(state) showNotification("Misc Toggle "..(state and "ON" or "OFF"),2) end)
createSlider(tab3,"Sensitivity",1,10,5)
createToggle(tab3,"Settings Toggle",false,function(state) showNotification("Settings Toggle "..(state and "ON" or "OFF"),2) end)

showNotification("BlueWare Loaded",3)
